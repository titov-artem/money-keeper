<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean class="org.springframework.context.annotation.CommonAnnotationBeanPostProcessor"/>
    <bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor"/>

    <!-- ui -->
    <bean id="endpoint" class="com.github.money.keeper.view.ui.Endpoint">
        <property name="controllers">
            <list>
                <ref bean="categoryController"/>
                <ref bean="applicationController"/>
                <ref bean="bankStatementController"/>
                <ref bean="reportsController"/>
                <ref bean="transactionsController"/>
                <ref bean="accountController"/>
                <ref bean="storeController"/>
            </list>
        </property>
    </bean>

    <!-- controller -->
    <bean id="categoryController" class="com.github.money.keeper.view.contoller.CategoryController">
        <property name="categoryService" ref="categoryService"/>
        <property name="storeRepo" ref="storeRepo"/>
    </bean>

    <bean id="applicationController" class="com.github.money.keeper.view.contoller.ApplicationController"/>

    <bean id="bankStatementController" class="com.github.money.keeper.view.contoller.BankStatementController">
        <property name="transactionParserProvider" ref="transactionParserProvider"/>
        <property name="storeService" ref="storeService"/>
        <property name="transactionRepo" ref="transactionRepo"/>
        <property name="categoryService" ref="categoryService"/>
        <property name="transactionService" ref="transactionService"/>
        <property name="accountRepo" ref="accountRepo"/>
    </bean>

    <bean id="reportsController" class="com.github.money.keeper.view.contoller.ReportsController">
        <property name="categoryService" ref="categoryService"/>
        <property name="transactionRepo" ref="transactionRepo"/>
        <property name="storeService" ref="storeService"/>
        <property name="accountRepo" ref="accountRepo"/>
    </bean>

    <bean id="transactionsController" class="com.github.money.keeper.view.contoller.TransactionsController">
        <property name="storeService" ref="storeService"/>
        <property name="transactionRepo" ref="transactionRepo"/>
        <property name="transactionService" ref="transactionService"/>
    </bean>

    <bean id="accountController" class="com.github.money.keeper.view.contoller.AccountController">
        <property name="accountRepo" ref="accountRepo"/>
    </bean>

    <bean id="storeController" class="com.github.money.keeper.view.contoller.StoreController">
        <property name="storeRepo" ref="storeRepo"/>
        <property name="categoryService" ref="categoryService"/>
    </bean>

    <!-- service -->
    <bean id="storeService" class="com.github.money.keeper.service.impl.StoreServiceImpl">
        <property name="transactionRepo" ref="transactionRepo"/>
        <property name="storeClusterizer" ref="storeClusterizer"/>
        <property name="storeRepo" ref="storeRepo"/>
    </bean>

    <bean id="categoryService" class="com.github.money.keeper.service.impl.CategoryServiceImpl">
        <property name="categoryRepo" ref="categoryRepo"/>
        <property name="storeRepo" ref="storeRepo"/>
        <property name="storeToCategoryRepo" ref="storeToCategoryRepo"/>
    </bean>

    <bean id="transactionService" class="com.github.money.keeper.service.impl.TransactionServiceImpl">
        <property name="storeService" ref="storeService"/>
        <property name="transactionRepo" ref="transactionRepo"/>
    </bean>

    <!-- storage -->
    <bean id="categoryRepo" class="com.github.money.keeper.storage.memory.InMemoryFileBackedCategoryRepo">
        <!-- TODO use property -->
        <property name="storageFileName" value="categories.json"/>
    </bean>

    <bean id="transactionRepo" class="com.github.money.keeper.storage.memory.InMemoryFileBackedTransactionRepo">
        <!-- TODO use property -->
        <property name="storageFileName" value="transactions.json"/>
    </bean>

    <bean id="storeRepo" class="com.github.money.keeper.storage.memory.InMemoryFileBackedStoreRepo">
        <!-- TODO use property -->
        <property name="storageFileName" value="stores.json"/>
    </bean>

    <bean id="accountRepo" class="com.github.money.keeper.storage.memory.InMemoryFileBackedAccountRepo">
        <!-- TODO use property -->
        <property name="storageFileName" value="accounts.json"/>
    </bean>

    <bean id="storeToCategoryRepo" class="com.github.money.keeper.storage.StoreToCategoryRepo">
        <!-- TODO use property -->
        <property name="storageFileName" value="storeToCategory.json"/>
    </bean>

    <!-- parsers -->
    <bean id="raiffeisenTransactionParser" class="com.github.money.keeper.parser.RaiffeisenTransactionParser"/>

    <bean id="tinkoffTransactionParser" class="com.github.money.keeper.parser.TinkoffTransactionParser"/>

    <bean id="transactionParserProvider" class="com.github.money.keeper.parser.TransactionParserProvider">
        <property name="parsers">
            <map>
                <entry key="RAIFFEISEN_CARD" value-ref="raiffeisenTransactionParser"/>
                <entry key="TINKOFF" value-ref="tinkoffTransactionParser"/>
            </map>
        </property>
    </bean>

    <!-- clusterization -->
    <!-- TODO refactor hierarchy -->
    <bean id="salePointClusterizer" class="com.github.money.keeper.clusterization.SimpleByNameClusterizer"/>

    <bean id="storeClusterizer" class="com.github.money.keeper.clusterization.StoreClusterizer">
        <constructor-arg ref="salePointClusterizer"/>
    </bean>

    <!-- templates -->
    <bean id="templateSupport" class="com.github.money.keeper.view.ui.template.TemplateSupport"/>

    <bean id="uiTemplateSupport" class="com.github.money.keeper.view.ui.template.UITemplateSupport">
        <property name="templateSupport" ref="templateSupport"/>
    </bean>

    <!-- system -->
    <bean id="clock" class="java.time.Clock" factory-method="systemDefaultZone"/>

</beans>